!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("fs")):"function"==typeof define&&define.amd?define(["fs"],e):"object"==typeof exports?exports.scribble=e(require("fs")):t.scribble=e(t.fs)}(window,(function(t){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=6)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.flat=e.dice=e.pickOne=e.sizzleMap=e.shuffle=e.expandStr=e.isNote=void 0,e.isNote=function(t){return/^[a-gA-G](?:#|b)?\d$/.test(t)},e.expandStr=function(t){return t=(t=(t=(t=JSON.stringify(t.split(""))).replace(/,"\[",/g,", [")).replace(/"\[",/g,"[")).replace(/,"\]"/g,"]"),JSON.parse(t)},e.shuffle=function(t){var e=t.length-1;return t.forEach((function(n,r){var o=Math.round(Math.random()*e);t[r]=t[o],t[o]=n})),t},e.sizzleMap=function(t){void 0===t&&(t=127);var e=Math.PI,n=[e/6,e/4,e/3,e/2,2*e/3,3*e/4,5*e/6,e],r=[0,e/6,e/4,e/3,e/2,2*e/3,3*e/4,5*e/6];return r.reverse(),n.concat(r).map((function(e){return Math.round(Math.sin(e)*t)}))},e.pickOne=function(t){return t.length>1?t[Math.round(Math.random())]:t[0]},e.dice=function(){return!!Math.round(Math.random())},e.flat=function(t){return t.reduce((function(t,e){return t.concat(e)}),[])}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.addChord=e.chords=e.getChord=void 0;var r=n(5),o=n(0),i=r.ChordType.all(),a=o.flat(i.map((function(t){return t.aliases.concat([t.name])}))).filter(Boolean);e.getChord=function(t){if(o.isNote(t))throw new Error(t+" is not a chord!");var e=t.split("-"),n=r.Chord.tokenize(e[0]),i=n[0],a=n[1];"4"!==i[1]&&"5"!==i[1]||(a=i[1],i=i.replace(/\d/,""));var s={"4th":"4","5th":"5","7th":"7","9th":"9","11th":"11","13th":"13"};if(s[a]&&(a=s[a]),!r.ChordType.get(a))throw new TypeError("Invalid chord name: "+a);var c=r.Chord.get(i+a),u=i+(e[1]||4);return(c.intervals||[]).map((function(t){var e=r.Note.transpose(u,t);return r.Note.simplify(e)}))},e.chords=function(){var t={4:"4th",5:"5th",7:"7th",9:"9th",11:"11th",13:"13th"};return a.map((function(e){return/^\d+$/.test(e)&&t[e]?t[e]:e}))},e.addChord=function(t,e,n){r.ChordType.add(t,e,n)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.scales=e.getScale=void 0;var r=n(5);e.getScale=function(t){t=(t=(t=t&&t.toLowerCase()).replace("#5p","#5P")).replace("#7m","#7M");var e=r.Scale.tokenize(t)[1];if(!r.ScaleType.get(e))throw new Error(t+" does not exist!");return r.Scale.get(t).notes.map(r.Note.simplify)},e.scales=function(){return r.Scale.names()}},function(t,e,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.clip=void 0;var o=n(0),i=n(1),a="undefined"!=typeof window&&n(7).browserClip,s={"1m":2048,"2m":4096,"3m":6144,"4m":8192,"1n":512,"2n":256,"4n":128,"8n":64,"16n":32},c=function(t){if(o.isNote(t))return[t];if(Array.isArray(t))return t.forEach((function(t){if(!o.isNote(t))throw new TypeError("array must comprise valid notes")})),t;if(!Array.isArray(t)){var e=i.getChord(t);if(e&&e.length)return e}throw new Error("Chord "+t+" not found")};e.clip=function(t){if("string"==typeof(t=r(r({},{notes:["C4"],pattern:"x",shuffle:!1,sizzle:!1,sizzleReps:1,arpegiate:!1,subdiv:"4n",amp:100,accentLow:70,randomNotes:null,effects:[],offlineRendering:!1}),t||{})).notes&&(t.notes=t.notes.replace(/\s{2,}/g," "),t.notes=t.notes.split(" ")),t.notes=t.notes.map(c),/[^x\-_\[\]R]/.test(t.pattern))throw new TypeError("pattern can only comprise x - _ [ ], found "+t.pattern);if(t.shuffle&&(t.notes=o.shuffle(t.notes)),t.randomNotes&&"string"==typeof t.randomNotes&&(t.randomNotes=t.randomNotes.replace(/\s{2,}/g," ").split(/\s/)),t.randomNotes&&(t.randomNotes=t.randomNotes.map(c)),t.synth||t.instrument||t.sample||t.buffer||t.player||t.samples||t.sampler)return a(t);var e=[],n=0,i=function(r,o){r.forEach((function(r){if("string"==typeof r){var a=null;"x"===r&&(a=t.notes[n],n++),"R"===r&&(Math.round(Math.random())||t.randomNotes)&&(a=t.randomNotes?t.randomNotes[Math.round(Math.random()*(t.randomNotes.length-1))]:t.notes[n],n++),"x"!==r&&"-"!==r&&"R"!==r||e.push({note:a,length:o,level:"R"!==r||t.randomNotes?t.amp:t.accentLow}),"_"===r&&e.length&&(e[e.length-1].length+=o),n===t.notes.length&&(n=0)}Array.isArray(r)&&i(r,o/r.length)}))};if(i(o.expandStr(t.pattern),s[t.subdiv]||s["4n"]),t.sizzle){var u=[],m=!0===t.sizzle?"sin":t.sizzle,l=e.length,f=t.amp,d=t.sizzleReps,p=f/(l/d);if("sin"===m||"cos"===m)for(var h=0;h<l;h++){var P=Math[m](h*Math.PI/(l/d))*f;u.push(Math.round(Math.abs(P)))}if("rampUp"===m)for(P=0,h=0;h<l;h++)h%(l/d)==0?P=0:P+=p,u.push(Math.round(Math.abs(P)));if("rampDown"===m)for(P=f,h=0;h<l;h++)h%(l/d)==0?P=f:P-=p,u.push(Math.round(Math.abs(P)));for(h=0;h<u.length;h++)e[h].level=u[h]?u[h]:1}if(t.accent){if(/[^x\-]/.test(t.accent))throw new TypeError("Accent can only have x and - characters");for(var M=0,y=0,v=e;y<v.length;y++){var g=v[y];P="x"===t.accent[M]?t.amp:t.accentLow;t.sizzle&&(P=(g.level+P)/2),g.level=Math.round(P),(M+=1)===t.accent.length&&(M=0)}}return e}},function(t,e,n){(function(t){var n={};!function(t){var e=t.DEFAULT_VOLUME=90,n=(t.DEFAULT_DURATION=128,t.DEFAULT_CHANNEL=0,{midi_letter_pitches:{a:21,b:23,c:12,d:14,e:16,f:17,g:19},midiPitchFromNote:function(t){var e=/([a-g])(#+|b+)?([0-9]+)$/i.exec(t),r=e[1].toLowerCase(),o=e[2]||"";return 12*parseInt(e[3],10)+n.midi_letter_pitches[r]+("#"==o.substr(0,1)?1:-1)*o.length},ensureMidiPitch:function(t){return"number"!=typeof t&&/[^0-9]/.test(t)?n.midiPitchFromNote(t):parseInt(t,10)},midi_pitches_letter:{12:"c",13:"c#",14:"d",15:"d#",16:"e",17:"f",18:"f#",19:"g",20:"g#",21:"a",22:"a#",23:"b"},midi_flattened_notes:{"a#":"bb","c#":"db","d#":"eb","f#":"gb","g#":"ab"},noteFromMidiPitch:function(t,e){var r,o=0,i=t;e=e||!1;return t>23&&(i=t-12*(o=Math.floor(t/12)-1)),r=n.midi_pitches_letter[i],e&&r.indexOf("#")>0&&(r=n.midi_flattened_notes[r]),r+o},mpqnFromBpm:function(t){var e=Math.floor(6e7/t),n=[];do{n.unshift(255&e),e>>=8}while(e);for(;n.length<3;)n.push(0);return n},bpmFromMpqn:function(t){if(void 0!==t[0]){0;for(var e=0,n=t.length-1;n>=0;++e,--n)t[e]<<n}return Math.floor(6e7/t)},codes2Str:function(t){return String.fromCharCode.apply(null,t)},str2Bytes:function(t,e){if(e)for(;t.length/2<e;)t="0"+t;for(var n=[],r=t.length-1;r>=0;r-=2){var o=0===r?t[r]:t[r-1]+t[r];n.unshift(parseInt(o,16))}return n},translateTickTime:function(t){for(var e=127&t;t>>=7;)e<<=8,e|=127&t|128;for(var n=[];n.push(255&e),128&e;)e>>=8;return n}}),r=function(t){if(!this)return new r(t);!t||null===t.type&&void 0===t.type||null===t.channel&&void 0===t.channel||null===t.param1&&void 0===t.param1||(this.setTime(t.time),this.setType(t.type),this.setChannel(t.channel),this.setParam1(t.param1),this.setParam2(t.param2))};r.NOTE_OFF=128,r.NOTE_ON=144,r.AFTER_TOUCH=160,r.CONTROLLER=176,r.PROGRAM_CHANGE=192,r.CHANNEL_AFTERTOUCH=208,r.PITCH_BEND=224,r.prototype.setTime=function(t){this.time=n.translateTickTime(t||0)},r.prototype.setType=function(t){if(t<r.NOTE_OFF||t>r.PITCH_BEND)throw new Error("Trying to set an unknown event: "+t);this.type=t},r.prototype.setChannel=function(t){if(t<0||t>15)throw new Error("Channel is out of bounds.");this.channel=t},r.prototype.setParam1=function(t){this.param1=t},r.prototype.setParam2=function(t){this.param2=t},r.prototype.toBytes=function(){var t=[],e=this.type|15&this.channel;return t.push.apply(t,this.time),t.push(e),t.push(this.param1),void 0!==this.param2&&null!==this.param2&&t.push(this.param2),t};var o=function(t){if(!this)return new o(t);this.setTime(t.time),this.setType(t.type),this.setData(t.data)};o.SEQUENCE=0,o.TEXT=1,o.COPYRIGHT=2,o.TRACK_NAME=3,o.INSTRUMENT=4,o.LYRIC=5,o.MARKER=6,o.CUE_POINT=7,o.CHANNEL_PREFIX=32,o.END_OF_TRACK=47,o.TEMPO=81,o.SMPTE=84,o.TIME_SIG=88,o.KEY_SIG=89,o.SEQ_EVENT=127,o.prototype.setTime=function(t){this.time=n.translateTickTime(t||0)},o.prototype.setType=function(t){this.type=t},o.prototype.setData=function(t){this.data=t},o.prototype.toBytes=function(){if(!this.type)throw new Error("Type for meta-event not specified.");var t=[];if(t.push.apply(t,this.time),t.push(255,this.type),Array.isArray(this.data))t.push(this.data.length),t.push.apply(t,this.data);else if("number"==typeof this.data)t.push(1,this.data);else if(null!==this.data&&void 0!==this.data){t.push(this.data.length);var e=this.data.split("").map((function(t){return t.charCodeAt(0)}));t.push.apply(t,e)}else t.push(0);return t};var i=function(t){if(!this)return new i(t);var e=t||{};this.events=e.events||[]};i.START_BYTES=[77,84,114,107],i.END_BYTES=[0,255,47,0],i.prototype.addEvent=function(t){return this.events.push(t),this},i.prototype.addNoteOn=i.prototype.noteOn=function(t,o,i,a){return this.events.push(new r({type:r.NOTE_ON,channel:t,param1:n.ensureMidiPitch(o),param2:a||e,time:i||0})),this},i.prototype.addNoteOff=i.prototype.noteOff=function(t,o,i,a){return this.events.push(new r({type:r.NOTE_OFF,channel:t,param1:n.ensureMidiPitch(o),param2:a||e,time:i||0})),this},i.prototype.addNote=i.prototype.note=function(t,e,n,r,o){return this.noteOn(t,e,r,o),n&&this.noteOff(t,e,n,o),this},i.prototype.addChord=i.prototype.chord=function(t,e,n,r){if(!Array.isArray(e)&&!e.length)throw new Error("Chord must be an array of pitches");return e.forEach((function(e){this.noteOn(t,e,0,r)}),this),e.forEach((function(e,r){0===r?this.noteOff(t,e,n):this.noteOff(t,e)}),this),this},i.prototype.setInstrument=i.prototype.instrument=function(t,e,n){return this.events.push(new r({type:r.PROGRAM_CHANGE,channel:t,param1:e,time:n||0})),this},i.prototype.setTempo=i.prototype.tempo=function(t,e){return this.events.push(new o({type:o.TEMPO,data:n.mpqnFromBpm(t),time:e||0})),this},i.prototype.toBytes=function(){var t=0,e=[],r=i.START_BYTES,o=i.END_BYTES;this.events.forEach((function(n){var r=n.toBytes();t+=r.length,e.push.apply(e,r)})),t+=o.length;var a=n.str2Bytes(t.toString(16),4);return r.concat(a,e,o)};var a=function(t){if(!this)return new a(t);var e=t||{};if(e.ticks){if("number"!=typeof e.ticks)throw new Error("Ticks per beat must be a number!");if(e.ticks<=0||e.ticks>=32768||e.ticks%1!=0)throw new Error("Ticks per beat must be an integer between 1 and 32767!")}this.ticks=e.ticks||128,this.tracks=e.tracks||[]};a.HDR_CHUNKID="MThd",a.HDR_CHUNK_SIZE="\0\0\0",a.HDR_TYPE0="\0\0",a.HDR_TYPE1="\0",a.prototype.addTrack=function(t){return t?(this.tracks.push(t),this):(t=new i,this.tracks.push(t),t)},a.prototype.toBytes=function(){var t=this.tracks.length.toString(16),e=a.HDR_CHUNKID+a.HDR_CHUNK_SIZE;return parseInt(t,16)>1?e+=a.HDR_TYPE1:e+=a.HDR_TYPE0,e+=n.codes2Str(n.str2Bytes(t,2)),e+=String.fromCharCode(this.ticks/256,this.ticks%256),this.tracks.forEach((function(t){e+=n.codes2Str(t.toBytes())})),e},t.Util=n,t.File=a,t.Track=i,t.Event=r,t.MetaEvent=o}(n),null!==t?t.exports=n:null!==e?e=n:this.Midi=n}).call(this,n(12)(t))},function(t,e,n){"use strict";n.r(e),n.d(e,"AbcNotation",(function(){return F})),n.d(e,"Array",(function(){return o})),n.d(e,"Chord",(function(){return Rt})),n.d(e,"ChordType",(function(){return vt})),n.d(e,"Collection",(function(){return W})),n.d(e,"accToAlt",(function(){return y})),n.d(e,"altToAcc",(function(){return M})),n.d(e,"coordToInterval",(function(){return x})),n.d(e,"coordToNote",(function(){return A})),n.d(e,"decode",(function(){return d})),n.d(e,"deprecate",(function(){return a})),n.d(e,"distance",(function(){return E})),n.d(e,"encode",(function(){return l})),n.d(e,"fillStr",(function(){return i})),n.d(e,"interval",(function(){return O})),n.d(e,"isNamed",(function(){return s})),n.d(e,"isPitch",(function(){return c})),n.d(e,"note",(function(){return v})),n.d(e,"stepToLetter",(function(){return P})),n.d(e,"tokenizeInterval",(function(){return j})),n.d(e,"tokenizeNote",(function(){return b})),n.d(e,"transpose",(function(){return _})),n.d(e,"Core",(function(){return r})),n.d(e,"DurationValue",(function(){return Bt})),n.d(e,"Interval",(function(){return Qt})),n.d(e,"Key",(function(){return $e})),n.d(e,"Midi",(function(){return ae})),n.d(e,"Mode",(function(){return Qe})),n.d(e,"Note",(function(){return ye})),n.d(e,"Pcset",(function(){return mt})),n.d(e,"Progression",(function(){return Xe})),n.d(e,"Range",(function(){return tn})),n.d(e,"RomanNumeral",(function(){return Ce})),n.d(e,"Scale",(function(){return an})),n.d(e,"ScaleType",(function(){return xt})),n.d(e,"TimeSignature",(function(){return fn})),n.d(e,"ChordDictionary",(function(){return hn})),n.d(e,"PcSet",(function(){return pn})),n.d(e,"ScaleDictionary",(function(){return Pn})),n.d(e,"Tonal",(function(){return dn}));var r={};n.r(r),n.d(r,"accToAlt",(function(){return y})),n.d(r,"altToAcc",(function(){return M})),n.d(r,"coordToInterval",(function(){return x})),n.d(r,"coordToNote",(function(){return A})),n.d(r,"decode",(function(){return d})),n.d(r,"deprecate",(function(){return a})),n.d(r,"distance",(function(){return E})),n.d(r,"encode",(function(){return l})),n.d(r,"fillStr",(function(){return i})),n.d(r,"interval",(function(){return O})),n.d(r,"isNamed",(function(){return s})),n.d(r,"isPitch",(function(){return c})),n.d(r,"note",(function(){return v})),n.d(r,"stepToLetter",(function(){return P})),n.d(r,"tokenizeInterval",(function(){return j})),n.d(r,"tokenizeNote",(function(){return b})),n.d(r,"transpose",(function(){return _}));var o={};n.r(o),n.d(o,"compact",(function(){return B})),n.d(o,"permutations",(function(){return H})),n.d(o,"range",(function(){return U})),n.d(o,"rotate",(function(){return $})),n.d(o,"shuffle",(function(){return q})),n.d(o,"sortedNoteNames",(function(){return z})),n.d(o,"sortedUniqNoteNames",(function(){return L}));const i=(t,e)=>Array(Math.abs(e)+1).join(t);function a(t,e,n){return function(...r){return console.warn(`${t} is deprecated. Use ${e}.`),n.apply(this,r)}}function s(t){return null!==t&&"object"==typeof t&&"string"==typeof t.name}function c(t){return null!==t&&"object"==typeof t&&"number"==typeof t.step&&"number"==typeof t.alt}const u=[0,2,4,-1,1,3,5],m=u.map(t=>Math.floor(7*t/12));function l(t){const{step:e,alt:n,oct:r,dir:o=1}=t,i=u[e]+7*n;if(void 0===r)return[o*i];return[o*i,o*(r-m[e]-4*n)]}const f=[3,0,4,1,5,2,6];function d(t){const[e,n,r]=t,o=f[function(t){const e=(t+1)%7;return e<0?7+e:e}(e)],i=Math.floor((e+1)/7);if(void 0===n)return{step:o,alt:i,dir:r};return{step:o,alt:i,oct:n+4*i+m[o],dir:r}}const p={empty:!0,name:"",pc:"",acc:""},h=new Map,P=t=>"CDEFGAB".charAt(t),M=t=>t<0?i("b",-t):i("#",t),y=t=>"b"===t[0]?-t.length:t.length;function v(t){const e=h.get(t);if(e)return e;const n="string"==typeof t?function(t){const e=b(t);if(""===e[0]||""!==e[3])return p;const n=e[0],r=e[1],o=e[2],i=(n.charCodeAt(0)+3)%7,a=y(r),s=o.length?+o:void 0,c=l({step:i,alt:a,oct:s}),u=n+r+o,m=n+r,f=(I[i]+a+120)%12,d=void 0===s?(M=I[i]+a,v=12,(M%v+v)%v-1188):I[i]+a+12*(s+1),h=d>=0&&d<=127?d:null,P=void 0===s?null:440*Math.pow(2,(d-69)/12);var M,v;return{empty:!1,acc:r,alt:a,chroma:f,coord:c,freq:P,height:d,letter:n,midi:h,name:u,oct:s,pc:m,step:i}}(t):c(t)?v(function(t){const{step:e,alt:n,oct:r}=t,o=P(e);if(!o)return"";const i=o+M(n);return r||0===r?i+r:i}(t)):s(t)?v(t.name):p;return h.set(t,n),n}const g=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function b(t){const e=g.exec(t);return[e[1].toUpperCase(),e[2].replace(/x/g,"##"),e[3],e[4]]}function A(t){return v(d(t))}const I=[0,2,4,5,7,9,11];const T={empty:!0,name:"",acc:""},w=new RegExp("^([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})|(AA|A|P|M|m|d|dd)([-+]?\\d+)$");function j(t){const e=w.exec(""+t);return null===e?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}const C={};function O(t){return"string"==typeof t?C[t]||(C[t]=function(t){const e=j(t);if(""===e[0])return T;const n=+e[0],r=e[1],o=(Math.abs(n)-1)%7,i="PMMPPMM"[o];if("M"===i&&"P"===r)return T;const a="M"===i?"majorable":"perfectable",s=""+n+r,c=n<0?-1:1,u=8===n||-8===n?n:c*(o+1),m=function(t,e){return"M"===e&&"majorable"===t||"P"===e&&"perfectable"===t?0:"m"===e&&"majorable"===t?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*("perfectable"===t?e.length:e.length+1):0}(a,r),f=Math.floor((Math.abs(n)-1)/7),d=c*(N[o]+m+12*f),p=(c*(N[o]+m)%12+12)%12,h=l({step:o,alt:m,oct:f,dir:c});return{empty:!1,name:s,num:n,q:r,step:o,alt:m,dir:c,type:a,simple:u,semitones:d,chroma:p,coord:h,oct:f}}(t)):c(t)?O(function(t){const{step:e,alt:n,oct:r=0,dir:o}=t;if(!o)return"";return(o<0?"-":"")+(e+1+7*r)+function(t,e){return 0===e?"majorable"===t?"M":"P":-1===e&&"majorable"===t?"m":e>0?i("A",e):i("d","perfectable"===t?e:e+1)}("M"==="PMMPPMM"[e]?"majorable":"perfectable",n)}(t)):s(t)?O(t.name):T}const N=[0,2,4,5,7,9,11];function x(t){const[e,n=0]=t;return O(d(7*e+12*n<0?[-e,-n,-1]:[e,n,1]))}function _(t,e){const n=v(t),r=O(e);if(n.empty||r.empty)return"";const o=n.coord,i=r.coord;return A(1===o.length?[o[0]+i[0]]:[o[0]+i[0],o[1]+i[1]]).name}function E(t,e){const n=v(t),r=v(e);if(n.empty||r.empty)return"";const o=n.coord,i=r.coord,a=i[0]-o[0];return x([a,2===o.length&&2===i.length?i[1]-o[1]:-Math.floor(7*a/12)]).name}const S=(t,e)=>Array(e+1).join(t),D=/^(_{1,}|=|\^{1,}|)([abcdefgABCDEFG])([,']*)$/;function k(t){const e=D.exec(t);return e?[e[1],e[2],e[3]]:["","",""]}function R(t){const[e,n,r]=k(t);if(""===n)return"";let o=4;for(let t=0;t<r.length;t++)o+=","===r.charAt(t)?-1:1;const i="_"===e[0]?e.replace(/_/g,"b"):"^"===e[0]?e.replace(/\^/g,"#"):"";return n.charCodeAt(0)>96?n.toUpperCase()+i+(o+1):n+i+o}function V(t){const e=v(t);if(e.empty||!e.oct)return"";const{letter:n,acc:r,oct:o}=e;return("b"===r[0]?r.replace(/b/g,"_"):r.replace(/#/g,"^"))+(o>4?n.toLowerCase():n)+(5===o?"":o>4?S("'",o-5):S(",",4-o))}var F={abcToScientificNotation:R,scientificToAbcNotation:V,tokenize:k,transpose:function(t,e){return V(_(R(t),e))},distance:function(t,e){return E(R(t),R(e))}};function U(t,e){return t<e?function(t,e){const n=[];for(;e--;n[e]=e+t);return n}(t,e-t+1):function(t,e){const n=[];for(;e--;n[e]=t-e);return n}(t,t-e+1)}function $(t,e){const n=e.length,r=(t%n+n)%n;return e.slice(r,n).concat(e.slice(0,r))}function B(t){return t.filter(t=>0===t||t)}function z(t){return t.map(t=>v(t)).filter(t=>!t.empty).sort((t,e)=>t.height-e.height).map(t=>t.name)}function L(t){return z(t).filter((t,e,n)=>0===e||t!==n[e-1])}function q(t,e=Math.random){let n,r,o=t.length;for(;o;)n=Math.floor(e()*o--),r=t[o],t[o]=t[n],t[n]=r;return t}function H(t){return 0===t.length?[[]]:H(t.slice(1)).reduce((e,n)=>e.concat(t.map((e,r)=>{const o=n.slice();return o.splice(r,0,t[0]),o})),[])}function G(t,e){return t<e?function(t,e){const n=[];for(;e--;n[e]=e+t);return n}(t,e-t+1):function(t,e){const n=[];for(;e--;n[e]=t-e);return n}(t,t-e+1)}function K(t,e){const n=e.length,r=(t%n+n)%n;return e.slice(r,n).concat(e.slice(0,r))}function Y(t){return t.filter(t=>0===t||t)}var W={compact:Y,permutations:function t(e){return 0===e.length?[[]]:t(e.slice(1)).reduce((t,n)=>t.concat(e.map((t,r)=>{const o=n.slice();return o.splice(r,0,e[0]),o})),[])},range:G,rotate:K,shuffle:function(t,e=Math.random){let n,r,o=t.length;for(;o;)n=Math.floor(e()*o--),r=t[o],t[o]=t[n],t[n]=r;return t}};const J={empty:!0,name:"",setNum:0,chroma:"000000000000",normalized:"000000000000",intervals:[]},Q=t=>Number(t).toString(2),X=t=>parseInt(t,2),Z=/^[01]{12}$/;function tt(t){return Z.test(t)}const et={[J.chroma]:J};function nt(t){const e=tt(t)?t:"number"==typeof(n=t)&&n>=0&&n<=4095?Q(t):Array.isArray(t)?function(t){if(0===t.length)return J.chroma;let e;const n=[0,0,0,0,0,0,0,0,0,0,0,0];for(let r=0;r<t.length;r++)e=v(t[r]),e.empty&&(e=O(t[r])),e.empty||(n[e.chroma]=1);return n.join("")}(t):(t=>t&&tt(t.chroma))(t)?t.chroma:J.chroma;var n;return et[e]=et[e]||function(t){const e=X(t),n=function(t){const e=t.split("");return e.map((t,n)=>K(n,e).join(""))}(t).map(X).filter(t=>t>=2048).sort()[0],r=Q(n),o=it(t);return{empty:!1,name:"",setNum:e,chroma:t,normalized:r,intervals:o}}(e)}const rt=a("Pcset.pcset","Pcset.get",nt),ot=["1P","2m","2M","3m","3M","4P","5d","5P","6m","6M","7m","7M"];function it(t){const e=[];for(let n=0;n<12;n++)"1"===t.charAt(n)&&e.push(ot[n]);return e}function at(t,e=!0){const n=nt(t).chroma.split("");return Y(n.map((t,r)=>{const o=K(r,n);return e&&"0"===o[0]?null:o.join("")}))}function st(t){const e=nt(t).setNum;return t=>{const n=nt(t).setNum;return e&&e!==n&&(n&e)===n}}function ct(t){const e=nt(t).setNum;return t=>{const n=nt(t).setNum;return e&&e!==n&&(n|e)===n}}function ut(t){const e=nt(t);return t=>{const n=v(t);return e&&!n.empty&&"1"===e.chroma.charAt(n.chroma)}}var mt={get:nt,chroma:t=>nt(t).chroma,num:t=>nt(t).setNum,intervals:t=>nt(t).intervals,chromas:function(){return G(2048,4095).map(Q)},isSupersetOf:ct,isSubsetOf:st,isNoteIncludedIn:ut,isEqual:function(t,e){return nt(t).setNum===nt(e).setNum},filter:function(t){const e=ut(t);return t=>t.filter(e)},modes:at,pcset:rt};const lt={...J,name:"",quality:"Unknown",intervals:[],aliases:[]};let ft=[],dt={};function pt(t){return dt[t]||lt}const ht=a("ChordType.chordType","ChordType.get",pt);function Pt(){return ft.slice()}const Mt=a("ChordType.entries","ChordType.all",Pt);function yt(t,e,n){const r=function(t){const e=e=>-1!==t.indexOf(e);return e("5A")?"Augmented":e("3M")?"Major":e("5d")?"Diminished":e("3m")?"Minor":"Unknown"}(t),o={...nt(t),name:n||"",quality:r,intervals:t,aliases:e};ft.push(o),o.name&&(dt[o.name]=o),dt[o.setNum]=o,dt[o.chroma]=o,o.aliases.forEach(t=>function(t,e){dt[e]=t}(o,t))}[["1P 3M 5P","major","M ^ "],["1P 3M 5P 7M","major seventh","maj7 Δ ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 Δ9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth/ninth","6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 Δ#4 Δ#11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -Δ7 mΔ -^7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim ° o"],["1P 3m 5d 7d","diminished seventh","dim7 °7 o7"],["1P 3m 5d 7m","half-diminished","m7b5 ø -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 Δ9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]].forEach(([t,e,n])=>yt(t.split(" "),n.split(" "),e)),ft.sort((t,e)=>t.setNum-e.setNum);var vt={names:function(){return ft.map(t=>t.name).filter(t=>t)},symbols:function(){return ft.map(t=>t.aliases[0]).filter(t=>t)},get:pt,all:Pt,add:yt,removeAll:function(){ft=[],dt={}},keys:function(){return Object.keys(dt)},entries:Mt,chordType:ht};function gt(t){const e=t.map(t=>v(t).pc).filter(t=>t);if(0===v.length)return[];return function(t,e){const n=t[0],r=v(n).chroma,o=(t=>{const e=t.reduce((t,e)=>{const n=v(e).chroma;return void 0!==n&&(t[n]=t[n]||v(e).name),t},{});return t=>e[t]})(t),i=at(t,!1),a=[];return i.forEach((t,i)=>{Pt().filter(e=>e.chroma===t).forEach(t=>{const s=t.aliases[0],c=o(i);i!==r?a.push({weight:.5*e,name:`${c}${s}/${n}`}):a.push({weight:1*e,name:`${c}${s}`})})}),a}(e,1).filter(t=>t.weight).sort((t,e)=>e.weight-t.weight).map(t=>t.name)}const bt={...J,intervals:[],aliases:[]};let At=[],It={};function Tt(){return At.map(t=>t.name)}function wt(t){return It[t]||bt}const jt=a("ScaleDictionary.scaleType","ScaleType.get",wt);function Ct(){return At.slice()}const Ot=a("ScaleDictionary.entries","ScaleType.all",Ct);function Nt(t,e,n=[]){const r={...nt(t),name:e,intervals:t,aliases:n};return At.push(r),It[r.name]=r,It[r.setNum]=r,It[r.chroma]=r,r.aliases.forEach(t=>function(t,e){It[e]=t}(r,t)),r}[["1P 2M 3M 5P 6M","major pentatonic","pentatonic"],["1P 3M 4P 5P 7M","ionian pentatonic"],["1P 3M 4P 5P 7m","mixolydian pentatonic","indian"],["1P 2M 4P 5P 6M","ritusen"],["1P 2M 4P 5P 7m","egyptian"],["1P 3M 4P 5d 7m","neopolitan major pentatonic"],["1P 3m 4P 5P 6m","vietnamese 1"],["1P 2m 3m 5P 6m","pelog"],["1P 2m 4P 5P 6m","kumoijoshi"],["1P 2M 3m 5P 6m","hirajoshi"],["1P 2m 4P 5d 7m","iwato"],["1P 2m 4P 5P 7m","in-sen"],["1P 3M 4A 5P 7M","lydian pentatonic","chinese"],["1P 3m 4P 6m 7m","malkos raga"],["1P 3m 4P 5d 7m","locrian pentatonic","minor seven flat five pentatonic"],["1P 3m 4P 5P 7m","minor pentatonic","vietnamese 2"],["1P 3m 4P 5P 6M","minor six pentatonic"],["1P 2M 3m 5P 6M","flat three pentatonic","kumoi"],["1P 2M 3M 5P 6m","flat six pentatonic"],["1P 2m 3M 5P 6M","scriabin"],["1P 3M 5d 6m 7m","whole tone pentatonic"],["1P 3M 4A 5A 7M","lydian #5P pentatonic"],["1P 3M 4A 5P 7m","lydian dominant pentatonic"],["1P 3m 4P 5P 7M","minor #7M pentatonic"],["1P 3m 4d 5d 7m","super locrian pentatonic"],["1P 2M 3m 4P 5P 7M","minor hexatonic"],["1P 2A 3M 5P 5A 7M","augmented"],["1P 2M 3m 3M 5P 6M","major blues"],["1P 2M 4P 5P 6M 7m","piongio"],["1P 2m 3M 4A 6M 7m","prometheus neopolitan"],["1P 2M 3M 4A 6M 7m","prometheus"],["1P 2m 3M 5d 6m 7m","mystery #1"],["1P 2m 3M 4P 5A 6M","six tone symmetric"],["1P 2M 3M 4A 5A 7m","whole tone","messiaen's mode #1"],["1P 2m 4P 4A 5P 7M","messiaen's mode #5"],["1P 3m 4P 5d 5P 7m","minor blues","blues"],["1P 2M 3M 4P 5d 6m 7m","locrian major","arabian"],["1P 2m 3M 4A 5P 6m 7M","double harmonic lydian"],["1P 2M 3m 4P 5P 6m 7M","harmonic minor"],["1P 2m 3m 4d 5d 6m 7m","altered","super locrian","diminished whole tone","pomeroy"],["1P 2M 3m 4P 5d 6m 7m","locrian #2","half-diminished","aeolian b5"],["1P 2M 3M 4P 5P 6m 7m","mixolydian b6","melodic minor fifth mode","hindu"],["1P 2M 3M 4A 5P 6M 7m","lydian dominant","lydian b7","overtone"],["1P 2M 3M 4A 5P 6M 7M","lydian"],["1P 2M 3M 4A 5A 6M 7M","lydian augmented"],["1P 2m 3m 4P 5P 6M 7m","dorian b2","phrygian #6","melodic minor second mode"],["1P 2M 3m 4P 5P 6M 7M","melodic minor"],["1P 2m 3m 4P 5d 6m 7m","locrian"],["1P 2m 3m 4d 5d 6m 7d","ultralocrian","superlocrian bb7","·superlocrian diminished"],["1P 2m 3m 4P 5d 6M 7m","locrian 6","locrian natural 6","locrian sharp 6"],["1P 2A 3M 4P 5P 5A 7M","augmented heptatonic"],["1P 2M 3m 5d 5P 6M 7m","romanian minor"],["1P 2M 3m 4A 5P 6M 7m","dorian #4"],["1P 2M 3m 4A 5P 6M 7M","lydian diminished"],["1P 2m 3m 4P 5P 6m 7m","phrygian"],["1P 2M 3M 4A 5A 7m 7M","leading whole tone"],["1P 2M 3M 4A 5P 6m 7m","lydian minor"],["1P 2m 3M 4P 5P 6m 7m","phrygian dominant","spanish","phrygian major"],["1P 2m 3m 4P 5P 6m 7M","balinese"],["1P 2m 3m 4P 5P 6M 7M","neopolitan major"],["1P 2M 3m 4P 5P 6m 7m","aeolian","minor"],["1P 2M 3M 4P 5P 6m 7M","harmonic major"],["1P 2m 3M 4P 5P 6m 7M","double harmonic major","gypsy"],["1P 2M 3m 4P 5P 6M 7m","dorian"],["1P 2M 3m 4A 5P 6m 7M","hungarian minor"],["1P 2A 3M 4A 5P 6M 7m","hungarian major"],["1P 2m 3M 4P 5d 6M 7m","oriental"],["1P 2m 3m 3M 4A 5P 7m","flamenco"],["1P 2m 3m 4A 5P 6m 7M","todi raga"],["1P 2M 3M 4P 5P 6M 7m","mixolydian","dominant"],["1P 2m 3M 4P 5d 6m 7M","persian"],["1P 2M 3M 4P 5P 6M 7M","major","ionian"],["1P 2m 3M 5d 6m 7m 7M","enigmatic"],["1P 2M 3M 4P 5A 6M 7M","major augmented","major #5","ionian augmented","ionian #5"],["1P 2A 3M 4A 5P 6M 7M","lydian #9"],["1P 2m 2M 4P 4A 5P 6m 7M","messiaen's mode #4"],["1P 2m 3M 4P 4A 5P 6m 7M","purvi raga"],["1P 2m 3m 3M 4P 5P 6m 7m","spanish heptatonic"],["1P 2M 3M 4P 5P 6M 7m 7M","bebop"],["1P 2M 3m 3M 4P 5P 6M 7m","bebop minor"],["1P 2M 3M 4P 5P 5A 6M 7M","bebop major"],["1P 2m 3m 4P 5d 5P 6m 7m","bebop locrian"],["1P 2M 3m 4P 5P 6m 7m 7M","minor bebop"],["1P 2M 3m 4P 5d 6m 6M 7M","diminished","whole-half diminished"],["1P 2M 3M 4P 5d 5P 6M 7M","ichikosucho"],["1P 2M 3m 4P 5P 6m 6M 7M","minor six diminished"],["1P 2m 3m 3M 4A 5P 6M 7m","half-whole diminished","dominant diminished","messiaen's mode #2"],["1P 3m 3M 4P 5P 6M 7m 7M","kafi raga"],["1P 2M 3M 4P 4A 5A 6A 7M","messiaen's mode #6"],["1P 2M 3m 3M 4P 5d 5P 6M 7m","composite blues"],["1P 2M 3m 3M 4A 5P 6m 7m 7M","messiaen's mode #3"],["1P 2m 2M 3m 4P 4A 5P 6m 6M 7M","messiaen's mode #7"],["1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M","chromatic"]].forEach(([t,e,...n])=>Nt(t.split(" "),e,n));var xt={names:Tt,get:wt,all:Ct,add:Nt,removeAll:function(){At=[],It={}},keys:function(){return Object.keys(It)},entries:Ot,scaleType:jt};const _t={empty:!0,name:"",symbol:"",root:"",rootDegree:0,type:"",tonic:null,setNum:NaN,quality:"Unknown",chroma:"",normalized:"",aliases:[],notes:[],intervals:[]},Et=/^(6|64|7|9|11|13)$/;function St(t){const[e,n,r,o]=b(t);return""===e?["",t]:"A"===e&&"ug"===o?["","aug"]:o||"4"!==r&&"5"!==r?Et.test(r)?[e+n,r+o]:[e+n+r,o]:[e+n,r]}function Dt(t){if(""===t)return _t;if(Array.isArray(t)&&2===t.length)return kt(t[1],t[0]);{const[e,n]=St(t),r=kt(n,e);return r.empty?kt(t):r}}function kt(t,e,n){const r=pt(t),o=v(e||""),i=v(n||"");if(r.empty||e&&o.empty||n&&i.empty)return _t;const a=E(o.pc,i.pc),s=r.intervals.indexOf(a)+1;if(!i.empty&&!s)return _t;const c=Array.from(r.intervals);for(let t=1;t<s;t++){const t=c[0][0],e=c[0][1],n=parseInt(t,10)+7;c.push(`${n}${e}`),c.shift()}const u=o.empty?[]:c.map(t=>_(o,t));t=-1!==r.aliases.indexOf(t)?t:r.aliases[0];const m=`${o.empty?"":o.pc}${t}${i.empty||s<=1?"":"/"+i.pc}`,l=`${e?o.pc+" ":""}${r.name}${s>1&&n?" over "+i.pc:""}`;return{...r,name:l,symbol:m,type:r.name,root:i.name,intervals:c,rootDegree:s,tonic:o.name,notes:u}}var Rt={getChord:kt,get:Dt,detect:gt,chordScales:function(t){const e=ct(Dt(t).chroma);return Ct().filter(t=>e(t.chroma)).map(t=>t.name)},extended:function(t){const e=Dt(t),n=ct(e.chroma);return Pt().filter(t=>n(t.chroma)).map(t=>e.tonic+t.aliases[0])},reduced:function(t){const e=Dt(t),n=st(e.chroma);return Pt().filter(t=>n(t.chroma)).map(t=>e.tonic+t.aliases[0])},tokenize:St,transpose:function(t,e){const[n,r]=St(t);return n?_(n,e)+r:t},chord:a("Chord.chord","Chord.get",Dt)};const Vt=[];[[.125,"dl",["large","duplex longa","maxima","octuple","octuple whole"]],[.25,"l",["long","longa"]],[.5,"d",["double whole","double","breve"]],[1,"w",["whole","semibreve"]],[2,"h",["half","minim"]],[4,"q",["quarter","crotchet"]],[8,"e",["eighth","quaver"]],[16,"s",["sixteenth","semiquaver"]],[32,"t",["thirty-second","demisemiquaver"]],[64,"sf",["sixty-fourth","hemidemisemiquaver"]],[128,"h",["hundred twenty-eighth"]],[256,"th",["two hundred fifty-sixth"]]].forEach(([t,e,n])=>function(t,e,n){Vt.push({empty:!1,dots:"",name:"",value:1/t,fraction:t<1?[1/t,1]:[1,t],shorthand:e,names:n})}(t,e,n));const Ft={empty:!0,name:"",value:0,fraction:[0,0],shorthand:"",dots:"",names:[]};const Ut=/^([^.]+)(\.*)$/;function $t(t){const[e,n,r]=Ut.exec(t)||[],o=Vt.find(t=>t.shorthand===n||t.names.includes(n));if(!o)return Ft;const i=function(t,e){const n=Math.pow(2,e);let r=t[0]*n,o=t[1]*n;const i=r;for(let t=0;t<e;t++)r+=i/Math.pow(2,t+1);for(;r%2==0&&o%2==0;)r/=2,o/=2;return[r,o]}(o.fraction,r.length),a=i[0]/i[1];return{...o,name:t,dots:r,value:a,fraction:i}}var Bt={names:function(){return Vt.reduce((t,e)=>(e.names.forEach(e=>t.push(e)),t),[])},shorthands:function(){return Vt.map(t=>t.shorthand)},get:$t,value:t=>$t(t).value,fraction:t=>$t(t).fraction};const zt=O;function Lt(t){const e=O(t);return e.empty?"":e.simple+e.q}const qt=[1,2,2,3,3,4,5,5,6,6,7,7],Ht="P m M m M P d P m M m M".split(" ");const Gt=E,Kt=Jt((t,e)=>[t[0]+e[0],t[1]+e[1]]),Yt=Jt((t,e)=>[t[0]-e[0],t[1]-e[1]]);function Wt(t,e){const n=zt(t);if(n.empty)return"";const[r,o,i]=n.coord;return x([r+e,o,i]).name}function Jt(t){return(e,n)=>{const r=O(e).coord,o=O(n).coord;if(r&&o){return x(t(r,o)).name}}}var Qt={names:function(){return"1P 2M 3M 4P 5P 6m 7m".split(" ")},get:zt,name:t=>O(t).name,num:t=>O(t).num,semitones:t=>O(t).semitones,quality:t=>O(t).q,fromSemitones:function(t){const e=t<0?-1:1,n=Math.abs(t),r=n%12,o=Math.floor(n/12);return e*(qt[r]+7*o)+Ht[r]},distance:Gt,invert:function(t){const e=O(t);return e.empty?"":O({step:(7-e.step)%7,alt:"perfectable"===e.type?-e.alt:-(e.alt+1),oct:e.oct,dir:e.dir}).name},simplify:Lt,add:Kt,addTo:t=>e=>Kt(t,e),substract:Yt,transposeFifths:Wt};function Xt(t){return+t>=0&&+t<=127}function Zt(t){if(Xt(t))return+t;const e=v(t);return e.empty?null:e.midi}const te=Math.log(2),ee=Math.log(440);function ne(t){const e=12*(Math.log(t)-ee)/te+69;return Math.round(100*e)/100}const re="C C# D D# E F F# G G# A A# B".split(" "),oe="C Db D Eb E F Gb G Ab A Bb B".split(" ");function ie(t,e={}){if(isNaN(t)||t===-1/0||t===1/0)return"";t=Math.round(t);const n=(!0===e.sharps?re:oe)[t%12];if(e.pitchClass)return n;return n+(Math.floor(t/12)-1)}var ae={isMidi:Xt,toMidi:Zt,midiToFreq:function(t,e=440){return Math.pow(2,(t-69)/12)*e},midiToNoteName:ie,freqToMidi:ne};const se=["C","D","E","F","G","A","B"],ce=t=>t.name,ue=t=>t.map(v).filter(t=>!t.empty);const me=v;const le=_,fe=t=>e=>le(e,t),de=t=>e=>le(t,e);function pe(t,e){const n=me(t);if(n.empty)return"";const[r,o]=n.coord;return A(void 0===o?[r+e]:[r+e,o]).name}const he=(t,e)=>t.height-e.height;function Pe(t,e){return e=e||he,ue(t).sort(e).map(ce)}function Me(t){return Pe(t,he).filter((t,e,n)=>0===e||t!==n[e-1])}var ye={names:function(t){return void 0===t?se.slice():Array.isArray(t)?ue(t).map(ce):[]},get:me,name:t=>me(t).name,pitchClass:t=>me(t).pc,accidentals:t=>me(t).acc,octave:t=>me(t).oct,midi:t=>me(t).midi,ascending:he,descending:(t,e)=>e.height-t.height,sortedNames:Pe,sortedUniqNames:Me,fromMidi:function(t){return ie(t)},fromMidiSharps:function(t){return ie(t,{sharps:!0})},freq:t=>me(t).freq,fromFreq:function(t){return ie(ne(t))},fromFreqSharps:function(t){return ie(ne(t),{sharps:!0})},chroma:t=>me(t).chroma,transpose:le,tr:_,transposeBy:fe,trBy:fe,transposeFrom:de,trFrom:de,transposeFifths:pe,trFifths:pe,simplify:t=>{const e=me(t);return e.empty?"":ie(e.midi||e.chroma,{sharps:e.alt>0,pitchClass:null===e.midi})},enharmonic:function(t,e){const n=me(t);if(n.empty)return"";const r=me(e||ie(n.midi||n.chroma,{sharps:n.alt<0,pitchClass:!0}));if(r.empty||r.chroma!==n.chroma)return"";if(void 0===n.oct)return r.pc;const o=n.chroma-n.alt,i=r.chroma-r.alt,a=o>11||i<0?-1:o<0||i>11?1:0,s=n.oct+a;return r.pc+s}};const ve={empty:!0,name:"",chordType:""},ge={};function be(t){return"string"==typeof t?ge[t]||(ge[t]=function(t){const[e,n,r,o]=(i=t,Ie.exec(i)||["","","",""]);var i;if(!r)return ve;const a=r.toUpperCase(),s=we.indexOf(a),c=y(n);return{empty:!1,name:e,roman:r,interval:O({step:s,alt:c,dir:1}).name,acc:n,chordType:o,alt:c,step:s,major:r===a,oct:0,dir:1}}(t)):"number"==typeof t?be(we[t]||""):c(t)?be(M((e=t).alt)+we[e.step]):s(t)?be(t.name):ve;var e}const Ae=a("RomanNumeral.romanNumeral","RomanNumeral.get",be);const Ie=/^(#{1,}|b{1,}|x{1,}|)(IV|I{1,3}|VI{0,2}|iv|i{1,3}|vi{0,2})([^IViv]*)$/;const Te="I II III IV V VI VII",we=Te.split(" "),je=Te.toLowerCase().split(" ");var Ce={names:function(t=!0){return(t?we:je).slice()},get:be,romanNumeral:Ae};const Oe=Object.freeze([]),Ne={type:"major",tonic:"",alteration:0,keySignature:""},xe={tonic:"",grades:Oe,intervals:Oe,scale:Oe,chords:Oe,chordsHarmonicFunction:Oe,chordScales:Oe},_e={...Ne,...xe,type:"major",minorRelative:"",scale:Oe,secondaryDominants:Oe,secondaryDominantsMinorRelative:Oe,substituteDominants:Oe,substituteDominantsMinorRelative:Oe},Ee={...Ne,type:"minor",relativeMajor:"",natural:xe,harmonic:xe,melodic:xe},Se=(t,e,n="")=>e.map((e,r)=>`${t[r]}${n}${e}`);function De(t,e,n,r){return o=>{const i=t.map(t=>be(t).interval||""),a=i.map(t=>_(o,t));return{tonic:o,grades:t,intervals:i,scale:a,chords:Se(a,e),chordsHarmonicFunction:n.slice(),chordScales:Se(a,r," ")}}}const ke=(t,e)=>{const n=v(t),r=v(e);return n.empty||r.empty?0:r.coord[0]-n.coord[0]},Re=De("I II III IV V VI VII".split(" "),"maj7 m7 m7 maj7 7 m7 m7b5".split(" "),"T SD T SD D T D".split(" "),"major,dorian,phrygian,lydian,mixolydian,minor,locrian".split(",")),Ve=De("I II bIII IV V bVI bVII".split(" "),"m7 m7b5 maj7 m7 m7 maj7 7".split(" "),"T SD T SD D SD SD".split(" "),"minor,locrian,major,dorian,phrygian,lydian,mixolydian".split(",")),Fe=De("I II bIII IV V bVI VII".split(" "),"mMaj7 m7b5 +maj7 m7 7 maj7 o7".split(" "),"T SD T SD D SD D".split(" "),"harmonic minor,locrian 6,major augmented,lydian diminished,phrygian dominant,lydian #9,ultralocrian".split(",")),Ue=De("I II bIII IV V VI VII".split(" "),"m6 m7 +maj7 7 7 m7b5 m7b5".split(" "),"T SD T SD D  ".split(" "),"melodic minor,dorian b2,lydian augmented,lydian dominant,mixolydian b6,locrian #2,altered".split(","));var $e={majorKey:function(t){const e=v(t).pc;if(!e)return _e;const n=Re(e),r=ke("C",e),o=e=>{const n=be(e);return n.empty?"":_(t,n.interval)+n.chordType};return{...n,type:"major",minorRelative:_(e,"-3m"),alteration:r,keySignature:M(r),secondaryDominants:"- VI7 VII7 I7 II7 III7 -".split(" ").map(o),secondaryDominantsMinorRelative:"- IIIm7b5 IV#m7 Vm7 VIm7 VIIm7b5 -".split(" ").map(o),substituteDominants:"- bIII7 IV7 bV7 bVI7 bVII7 -".split(" ").map(o),substituteDominantsMinorRelative:"- IIIm7 Im7 IIbm7 VIm7 IVm7 -".split(" ").map(o)}},majorTonicFromKeySignature:function(t){return"number"==typeof t?pe("C",t):"string"==typeof t&&/^b+|#+$/.test(t)?pe("C",y(t)):null},minorKey:function(t){const e=v(t).pc;if(!e)return Ee;const n=ke("C",e)-3;return{type:"minor",tonic:e,relativeMajor:_(e,"3m"),alteration:n,keySignature:M(n),natural:Ve(e),harmonic:Fe(e),melodic:Ue(e)}}};const Be=[[0,2773,0,"ionian","","Maj7","major"],[1,2902,2,"dorian","m","m7"],[2,3418,4,"phrygian","m","m7"],[3,2741,-1,"lydian","","Maj7"],[4,2774,1,"mixolydian","","7"],[5,2906,3,"aeolian","m","m7","minor"],[6,3434,5,"locrian","dim","m7b5"]],ze={...J,name:"",alt:0,modeNum:NaN,triad:"",seventh:"",aliases:[]},Le=Be.map((function(t){const[e,n,r,o,i,a,s]=t,c=s?[s]:[],u=Number(n).toString(2);return{empty:!1,intervals:it(u),modeNum:e,chroma:u,normalized:u,name:o,setNum:n,alt:r,triad:i,seventh:a,aliases:c}})),qe={};function He(t){return"string"==typeof t?qe[t.toLowerCase()]||ze:t&&t.name?He(t.name):ze}Le.forEach(t=>{qe[t.name]=t,t.aliases.forEach(e=>{qe[e]=t})});const Ge=a("Mode.mode","Mode.get",He);function Ke(){return Le.slice()}const Ye=a("Mode.mode","Mode.all",Ke);function We(t){return(e,n)=>{const r=He(e);if(r.empty)return[];const o=K(r.modeNum,t),i=r.intervals.map(t=>_(n,t));return o.map((t,e)=>i[e]+t)}}function Je(t,e){const n=He(e),r=He(t);return n.empty||r.empty?"":Lt(Wt("1P",r.alt-n.alt))}var Qe={get:He,names:function(){return Le.map(t=>t.name)},all:Ke,distance:Je,relativeTonic:function(t,e,n){return _(n,Je(t,e))},notes:function(t,e){return He(t).intervals.map(t=>_(e,t))},triads:We(Be.map(t=>t[4])),seventhChords:We(Be.map(t=>t[5])),entries:Ye,mode:Ge};var Xe={fromRomanNumerals:function(t,e){return e.map(be).map(e=>_(t,O(e))+e.chordType)},toRomanNumerals:function(t,e){return e.map(e=>{const[n,r]=St(e);return be(O(E(t,n))).name+r})}};function Ze(t){const e=Y(t.map(Zt));return t.length&&e.length===t.length?e.reduce((t,e)=>{const n=t[t.length-1];return t.concat(G(n,e).slice(1))},[e[0]]):[]}var tn={numeric:Ze,chromatic:function(t,e){return Ze(t).map(t=>ie(t,e))}};const en={empty:!0,name:"",type:"",tonic:null,setNum:NaN,chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function nn(t){if("string"!=typeof t)return["",""];const e=t.indexOf(" "),n=v(t.substring(0,e));if(n.empty){const e=v(t);return e.empty?["",t]:[e.name,""]}const r=t.substring(n.name.length+1);return[n.name,r.length?r:""]}function rn(t){const e=Array.isArray(t)?t:nn(t),n=v(e[0]).name,r=wt(e[1]);if(r.empty)return en;const o=r.name,i=n?r.intervals.map(t=>_(n,t)):[],a=n?n+" "+o:o;return{...r,name:a,type:o,tonic:n,notes:i}}function on(t){const e=t.map(t=>v(t).pc).filter(t=>t),n=e[0],r=Me(e);return K(r.indexOf(n),r)}var an={get:rn,names:Tt,extended:function(t){const e=ct(rn(t).chroma);return Ct().filter(t=>e(t.chroma)).map(t=>t.name)},modeNames:function(t){const e=rn(t);if(e.empty)return[];const n=e.tonic?e.notes:e.intervals;return at(e.chroma).map((t,e)=>{const r=rn(t).name;return r?[n[e],r]:["",""]}).filter(t=>t[0])},reduced:function(t){const e=st(rn(t).chroma);return Ct().filter(t=>e(t.chroma)).map(t=>t.name)},scaleChords:function(t){const e=st(rn(t).chroma);return Pt().filter(t=>e(t.chroma)).map(t=>t.aliases[0])},scaleNotes:on,tokenize:nn,rangeOf:function(t){const e=function(t){const e=Array.isArray(t)?on(t):rn(t).notes,n=e.map(t=>v(t).chroma);return t=>{const r="number"==typeof t?t:v(t).height;if(void 0===r)return;const o=r%12,i=Math.floor(r/12)-1,a=n.indexOf(o);return-1!==a?e[a]+i:void 0}}(t);return(t,n)=>{const r=v(t).height,o=v(n).height;return void 0===r||void 0===o?[]:G(r,o).map(e).filter(t=>t)}},scale:a("Scale.scale","Scale.get",rn)};const sn={empty:!0,name:"",upper:void 0,lower:void 0,type:void 0,additive:[]},cn=["4/4","3/4","2/4","2/2","12/8","9/8","6/8","3/8"];const un=/^(\d?\d(?:\+\d)*)\/(\d)$/,mn=new Map;function ln(t){if("string"==typeof t){const[e,n,r]=un.exec(t)||[];return ln([n,r])}const[e,n]=t,r=+n;if("number"==typeof e)return[e,r];const o=e.split("+").map(t=>+t);return 1===o.length?[o[0],r]:[o,r]}var fn={names:function(){return cn.slice()},parse:ln,get:function(t){const e=mn.get(t);if(e)return e;const n=function([t,e]){const n=Array.isArray(t)?t.reduce((t,e)=>t+e,0):t,r=e;if(0===n||0===r)return sn;const o=Array.isArray(t)?`${t.join("+")}/${e}`:`${t}/${e}`,i=Array.isArray(t)?t:[];return{empty:!1,name:o,type:4===r||2===r?"simple":8===r&&n%3==0?"compound":"irregular",upper:n,lower:r,additive:i}}(ln(t));return mn.set(t,n),n}};const dn=r,pn=mt,hn=vt,Pn=xt},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.max=e.Session=e.midi=e.arp=e.progression=e.getChordsByProgression=e.getChordDegrees=e.clip=e.chords=e.chord=e.addChord=e.modes=e.scales=e.mode=e.scale=void 0;var r=n(2);Object.defineProperty(e,"scale",{enumerable:!0,get:function(){return r.getScale}}),Object.defineProperty(e,"mode",{enumerable:!0,get:function(){return r.getScale}}),Object.defineProperty(e,"scales",{enumerable:!0,get:function(){return r.scales}}),Object.defineProperty(e,"modes",{enumerable:!0,get:function(){return r.scales}});var o=n(1);Object.defineProperty(e,"addChord",{enumerable:!0,get:function(){return o.addChord}}),Object.defineProperty(e,"chord",{enumerable:!0,get:function(){return o.getChord}}),Object.defineProperty(e,"chords",{enumerable:!0,get:function(){return o.chords}});var i=n(3);Object.defineProperty(e,"clip",{enumerable:!0,get:function(){return i.clip}});var a=n(8);Object.defineProperty(e,"getChordDegrees",{enumerable:!0,get:function(){return a.getChordDegrees}}),Object.defineProperty(e,"getChordsByProgression",{enumerable:!0,get:function(){return a.getChordsByProgression}}),Object.defineProperty(e,"progression",{enumerable:!0,get:function(){return a.progression}});var s=n(9);Object.defineProperty(e,"arp",{enumerable:!0,get:function(){return s.arp}});var c=n(10);Object.defineProperty(e,"midi",{enumerable:!0,get:function(){return c.midi}});var u=n(13);Object.defineProperty(e,"Session",{enumerable:!0,get:function(){return u.Session}});var m=n(15);Object.defineProperty(e,"max",{enumerable:!0,get:function(){return m.max}})},function(t,e,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.browserClip=e.renderingDuration=e.totalPatternDuration=e.recursivelyApplyPatternToDurations=void 0;var a=n(0),s=function(t,e,n){return"R"===t&&e.randomNotes?e.randomNotes[(r=e.randomNotes.length-1,void 0===r&&(r=1),Math.round(Math.random()*r))]:e.notes[n%e.notes.length];var r},c=function(t,e){return t.durations?t.durations[e%t.durations.length]:t.dur||t.subdiv||"8n"},u=function(t){var e=0;return t.instrument instanceof Tone.Player?function(n,r){"x"!==r&&"R"!==r||(t.instrument.start(n),e++)}:t.instrument instanceof Tone.PolySynth||t.instrument instanceof Tone.Sampler?function(n,r){"x"!==r&&"R"!==r||(t.instrument.triggerAttackRelease(s(r,t,e),c(t,e),n),e++)}:t.instrument instanceof Tone.NoiseSynth?function(n,r){"x"!==r&&"R"!==r||(t.instrument.triggerAttackRelease(c(t,e),n),e++)}:function(n,r){"x"!==r&&"R"!==r||(t.instrument.triggerAttackRelease(s(r,t,e)[0],c(t,e),n),e++)}};e.recursivelyApplyPatternToDurations=function(t,n,r){return void 0===r&&(r=[]),t.forEach((function(t){"string"==typeof t&&("x"!==t&&"R"!==t||r.push(n),"_"===t&&r.length&&(r[r.length-1]+=n)),Array.isArray(t)&&e.recursivelyApplyPatternToDurations(t,n/t.length,r)})),r};var m=function(t,n){var r;if(n=n||Tone.getContext(),!t.pattern)throw new Error("No pattern provided!");if(!(t.player||t.instrument||t.sample||t.buffer||t.synth||t.sampler||t.samples))throw new Error("No player or instrument provided!");t.durations||t.dur||(t.durations=e.recursivelyApplyPatternToDurations(a.expandStr(t.pattern),Tone.Ticks(t.subdiv||"4n").toSeconds()));var o=[];return t.effects&&(Array.isArray(t.effects)||(t.effects=[t.effects]),o=t.effects.map((function(t){return("string"==typeof t?new Tone[t]({context:n}):t.context!==n?d(t,n):t).toDestination()})).map((function(t){return"function"==typeof t.start?t.start():t}))),t.synth&&!t.instrument&&(t.instrument=t.synth,console.warn('The "synth" parameter will be deprecated in the future. Please use the "instrument" parameter instead.')),t.instrument=t.sample||t.buffer?new Tone.Player({url:t.sample||t.buffer,context:n}):t.sampler?t.sampler:t.player?t.player:t.samples?new Tone.Sampler({url:t.samples,context:n}):"string"==typeof t.instrument?new Tone[t.instrument]({context:n}):t.instrument,t.instrument.context!==n&&(t.instrument=d(t.instrument,n)),t.volume&&(t.instrument.volume.value=t.volume),(r=t.instrument).chain.apply(r,o).toDestination(),new Tone.Sequence({callback:u(t),events:a.expandStr(t.pattern),subdivision:t.subdiv||"4n",context:n})};e.totalPatternDuration=function(t,e){return"number"==typeof e?e*a.expandStr(t).length:Tone.Ticks(e).toSeconds()*a.expandStr(t).length};e.renderingDuration=function(t,n,r,o){var i=t.split("").filter((function(t){return"x"===t})).length,a=t.split("").filter((function(t){return"R"===t})).length,s=(null==o?void 0:o.length)?i:i+a,c=r.length||1;return e.totalPatternDuration(t,n)/s*function(t,e){for(var n=t<e?[t,e]:[e,t],r=n[0],o=n[1],i=o;i%r!=0;)i+=o;return i}(c,s)};var l,f=0,d=function(t,e){if(t instanceof Tone.PolySynth)return new Tone.PolySynth(Tone[t._dummyVoice.name],r(r({},t.get()),{context:e}));if(t instanceof Tone.Player)return new Tone.Player({url:t._buffer,context:e});if(t instanceof Tone.Sampler){var n=t.get(),o={attack:n.attack,curve:n.curve,release:n.release,volume:n.volume},i={baseUrl:t._buffers.baseUrl,urls:Object.fromEntries(t._buffers._buffers.entries())};return new Tone.Sampler(r(r(r({},o),i),{context:e}))}return new Tone[t.name](r(r({},t.get()),{context:e}))};e.browserClip=function(t){return t.offlineRendering?function(t,e){l||(l=Tone.getContext()),f++;var n=new Tone.Player({context:l,loop:!0});return Tone.Offline((function(e){return o(void 0,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return n=m(t,e),[4,Tone.loaded()];case 1:return r.sent(),n.start(),e.transport.start(),[2]}}))}))}),e).then((function(e){var r;n.buffer=e,0===--f&&(Tone.setContext(l),null===(r=t.offlineRenderingCallback)||void 0===r||r.call(t))})),n.toDestination(),n.sync(),n}(t,e.renderingDuration(t.pattern,t.subdiv||"4n",t.notes,t.randomNotes)):m(t,l)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.progression=e.getChordsByProgression=e.getChordDegrees=void 0;var r=n(2),o=n(0);e.getChordDegrees=function(t){var e={ionian:["I","ii","iii","IV","V","vi","vii°"],dorian:["i","ii","III","IV","v","vi°","VII"],phrygian:["i","II","III","iv","v°","VI","vii"],lydian:["I","II","iii","iv°","V","vi","vii"],mixolydian:["I","ii","iii°","IV","v","vi","VII"],aeolian:["i","ii°","III","iv","v","VI","VII"],locrian:["i°","II","iii","iv","V","VI","vii"],"melodic minor":["i","ii","III+","IV","V","vi°","vii°"],"harmonic minor":["i","ii°","III+","iv","V","VI","vii°"]};return e.major=e.ionian,e.minor=e.aeolian,e[t]||[]};var i={i:0,ii:1,iii:2,iv:3,v:4,vi:5,vii:6};e.getChordsByProgression=function(t,e){var n=t.split(" ");n[0].match(/\d/)||(n[0]+="4",t=n.join(" "));var o=r.getScale(t);return e.replace(/\s*,+\s*/g," ").split(" ").map((function(t,e){var n=function(t){var e=t.replace(/\W/g,""),n="M";return e.toLowerCase()===e&&(n="m"),t.indexOf("°")>-1?n+"7b5":t.indexOf("+")>-1?n+"#5":t.indexOf("7")>-1?"M"===n?"Maj7":"m7":n}(t),r=i[t.replace(/\W|\d/g,"").toLowerCase()],a=o[r],s=a.replace(/\D+/,"");return a.replace(/\d/,"")+n+"-"+s})).toString().replace(/,/g," ")};var a=function(t){var e=t.T,n=t.P,r=t.D;return function(t){void 0===t&&(t=4);var i=[];i.push(o.pickOne(e));var a=1;for(a<t-1&&(i.push(o.pickOne(n)),a++),a<t-1&&o.dice()&&(i.push(o.pickOne(n)),a++),a<t-1&&(i.push(o.pickOne(r)),a++),a<t-1&&(i.push(o.pickOne(n)),a++),a<t-1&&(i.push(o.pickOne(r)),a++),a<t-1&&o.dice()&&(i.push(o.pickOne(n)),a++);a<t;)i.push(o.pickOne(r)),a++;return i}},s=a({T:["I","vi"],P:["ii","IV"],D:["V"]}),c=a({T:["i","VI"],P:["ii","iv"],D:["V"]});e.progression=function(t,e){return void 0===e&&(e=4),"major"===t||"M"===t?s(e):"minor"===t||"m"===t?c(e):void 0}},function(t,e,n){"use strict";var r=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r};Object.defineProperty(e,"__esModule",{value:!0}),e.arp=void 0;var o=n(1),i=function(t,e){var n=function(t){return t.replace(/\d/,"")+(+t.replace(/\D/g,"")+1)},o=t.map(n),i=o.map(n);return r(t,o,i).slice(0,e)};e.arp=function(t){var e=[],n={count:4,order:"0123",chords:""};if("string"==typeof t)n.chords=t;else{if(t.order&&t.order.match(/\D/g))throw new TypeError("Invalid value for order");if(t.count>8||t.count<2)throw new TypeError("Invalid value for count");t.count&&!t.order&&(n.order=Array.from(Array(t.count).keys()).join("")),Object.assign(n,t)}if("string"==typeof n.chords)for(var a=function(t){var a=i(o.getChord(t),n.count),s=n.order.split("").map((function(t){return a[t]}));e=r(e,s)},s=0,c=n.chords.split(" ");s<c.length;s++){a(c[s])}else{if(!Array.isArray(n.chords))throw new TypeError("Invalid value for chords");for(var u=function(t){var o=i(t,n.count),a=n.order.split("").map((function(t){return o[t]}));e=r(e,a)},m=0,l=n.chords;m<l.length;m++){u(l[m])}}return e}},function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),o=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.hasOwnProperty.call(t,n)&&r(e,t,n);return o(e,t),e},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.midi=void 0;var s=a(n(11)),c=i(n(4));e.midi=function(t,e,n,r){void 0===e&&(e="music.mid");var o=m(t,n,r).toBytes();return null===e?o:(e.endsWith(".mid")||(e+=".mid"),"undefined"!=typeof window&&window.URL&&window.URL.createObjectURL?u(o,e):(s.default.writeFileSync(e,o,"binary"),void console.log("MIDI file generated: "+e+".")))};var u=function(t,e){for(var n=new Uint8Array(t.length),r=0;r<t.length;r++){var o=t.charCodeAt(r);n[r]=o}var i=new Blob([n],{type:"audio/midi"}),a=document.createElement("a");return a.href="undefined"!=typeof window&&void 0!==window.URL&&void 0!==window.URL.createObjectURL&&window.URL.createObjectURL(i)||"",a.download=e,a.innerText="Download MIDI file",a},m=function(t,e,n){var r=new c.File,o=new c.Track;"number"==typeof e&&o.setTempo(e),"string"==typeof n&&o.addEvent(new c.MetaEvent({type:c.MetaEvent.TRACK_NAME,data:n})),r.addTrack(o);for(var i=0,a=t;i<a.length;i++){var s=a[i],u=s.level||127;s.note?"string"==typeof s.note?(o.noteOn(0,s.note,s.length,u),o.noteOff(0,s.note,s.length,u)):o.addChord(0,s.note,s.length,u):o.noteOff(0,"",s.length)}return r}},function(e,n){e.exports=t},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Session=void 0;var r=n(14),o=function(){function t(t){t=t||[],this.sessionChannels=t.map((function(t,e){return t.idx=t.idx||e,new r.Channel(t)}))}return t.prototype.createChannel=function(t){t.idx=t.idx||this.sessionChannels.length;var e=new r.Channel(t);return this.sessionChannels.push(e),e},Object.defineProperty(t.prototype,"channels",{get:function(){return this.sessionChannels},enumerable:!1,configurable:!0}),t.prototype.startRow=function(t){this.sessionChannels.forEach((function(e){e.startClip(t)}))},t.prototype.play=function(t){var e=this,n=t.channelPatterns,r=t.clipDuration||"4:0:0",o=Tone.Time(r).toSeconds(),i=function(t,e){t.map((function(t){return t.stop(e)}))};n.forEach((function(t){var n=t.channelIdx,r=t.pattern,a=[],s=0,c="-";r.split("").forEach((function(t){t!==c&&"_"!==t&&(i(a,s),a=function(t,n,r){return"-"===n?[]:e.channels.filter((function(e){return e.idx===t})).map((function(t){return t.clips[n].start(r)}))}(n,t,s)),c=t,s+=o})),i(a,s)}))},t}();e.Session=o},function(t,e,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},o=this&&this.__rest||function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n};Object.defineProperty(e,"__esModule",{value:!0}),e.Channel=void 0;var i=n(3),a=function(){var t=Tone.Transport.position.split(":");return"0"===t[0]&&"0"===t[1]?0:+t[0]+1+":0:0"},s=function(){function t(t){var e=this;this.idx=t.idx||0,this.activePatternIdx=-1,this.channelClips=[],t.sample&&(this.player=new Tone.Player(t.sample)),t.synth&&(this.instrument=new Tone[t.synth]),t.samples&&(this.sampler=new Tone.Sampler(t.samples));t.clips,t.samples,t.sample,t.synth;var n=o(t,["clips","samples","sample","synth"]);t.clips.forEach((function(t){e.addClip(r(r({},t),n))}),this)}return Object.defineProperty(t.prototype,"clips",{get:function(){return this.channelClips},enumerable:!1,configurable:!0}),t.prototype.startClip=function(t){this.activePatternIdx>-1&&this.activePatternIdx!==t&&this.stopClip(this.activePatternIdx),this.channelClips[t]&&"started"!==this.channelClips[t].state&&(this.activePatternIdx=t,this.channelClips[t].start(a()))},t.prototype.stopClip=function(t){this.channelClips[t].stop(a())},t.prototype.addClip=function(t,e){e=e||this.channelClips.length,t.pattern?this.channelClips[e]=i.clip(r({player:this.player,instrument:this.instrument,sampler:this.sampler},t)):this.channelClips[e]=null},Object.defineProperty(t.prototype,"activeClipIdx",{get:function(){return this.activePatternIdx},enumerable:!1,configurable:!0}),t}();e.Channel=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.max=void 0;var r=n(4);e.max=function(t,e){void 0===e&&(e="live_set view highlighted_clip_slot clip");var n=new LiveAPI(e),o=t.reduce((function(t,e){return t+e.length}),0);n.set("loop_end",o/512),n.call("remove_notes",0,1,258,127),n.call("set_notes");var i=t.reduce((function(t,e){return t+(e.note?e.note.length:0)}),0);n.call("notes",i);var a=0;t.forEach((function(t){t.note?(t.note.forEach((function(e){n.call("note",r.Util.midiPitchFromNote(e),a.toFixed(2).toString(),(t.length/512).toFixed(2).toString(),t.level||100,0)})),a+=t.length/512):a+=t.length/512})),n.call("done")}}])}));
//# sourceMappingURL=scribbletune.js.map